{"version":3,"sources":["utils.ts","components/TacticBoard.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Chess","require","moveSound","Howl","src","errorSound","getSideToPlayFromFen","fen","turn","makeMove","move","chess","fullMove","validateMove","solution","length","next","san","slice","TacticBoard","tactic","onIncorrect","onCorrect","onSolve","onAutoPlay","useState","setFen","setSolution","useEffect","setTimeout","blunderMove","transitionDuration","position","width","orientation","onDrop","autoNext","handleMove","from","sourceSquare","to","targetSquare","promotion","fetchTactic","a","axios","post","process","type","res","data","id","fenBefore","forcedLine","App","tactics","setTactics","hint","setHint","loadTactic","newTactic","it","concat","console","log","error","className","sideToPlay","play","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.82afe08d.chunk.js","sourcesContent":["import { ChessInstance, ShortMove } from \"chess.js\";\nimport { Howl } from \"howler\";\n\nconst Chess = require(\"chess.js\");\n\nexport const moveSound = new Howl({\n  src: [\"move.mp3\"],\n});\n\nexport const errorSound = new Howl({\n  src: [\"error.mp3\"],\n});\n\nexport function getSideToPlayFromFen(fen: string) {\n  const chess: ChessInstance = new Chess(fen);\n  return chess.turn();\n}\n\nexport function makeMove(fen: string, move: ShortMove | string) {\n  const chess: ChessInstance = new Chess(fen);\n  const fullMove = chess.move(move);\n  return fullMove ? { fullMove, fen: chess.fen() } : null;\n}\n\nexport function validateMove(\n  fen: string,\n  move: ShortMove | string,\n  solution: string[]\n): null | { solution: string[]; fen: string } {\n  if (solution.length === 0) {\n    return null;\n  }\n\n  const next = makeMove(fen, move);\n\n  if (next && next.fullMove.san === solution[0]) {\n    return {\n      fen: next.fen,\n      solution: solution.slice(1),\n    };\n  }\n\n  return null;\n}\n","import React, { useState, useEffect } from \"react\";\nimport { ShortMove } from \"chess.js\";\nimport Chessboard from \"chessboardjsx\";\nimport Tactic from \"../types/Tactic\";\nimport { getSideToPlayFromFen, makeMove, validateMove } from \"../utils\";\n\ninterface Props {\n  tactic: Tactic;\n  onIncorrect: () => void;\n  onCorrect: () => void;\n  onSolve: () => void;\n  onAutoPlay: () => void;\n}\n\nconst TacticBoard: React.FC<Props> = ({\n  tactic,\n  onIncorrect,\n  onCorrect,\n  onSolve,\n  onAutoPlay,\n}) => {\n  const [fen, setFen] = useState(tactic.fen);\n  const [solution, setSolution] = useState(tactic.solution);\n\n  useEffect(() => {\n    setTimeout(() => {\n      const next = makeMove(tactic.fen, tactic.blunderMove);\n      if (next) {\n        setFen(next.fen);\n        onAutoPlay();\n      }\n    }, 100);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleMove = (move: string | ShortMove) => {\n    const next = validateMove(fen, move, solution);\n\n    if (next) {\n      setFen(next.fen);\n      setSolution(next.solution);\n\n      if (next.solution.length > 0) {\n        onCorrect();\n\n        const autoNext = validateMove(\n          next.fen,\n          next.solution[0],\n          next.solution\n        );\n\n        if (autoNext) {\n          setFen(autoNext.fen);\n          setSolution(autoNext.solution);\n          onAutoPlay();\n        }\n      } else {\n        onSolve();\n      }\n    } else {\n      onIncorrect();\n    }\n  };\n\n  return (\n    <Chessboard\n      transitionDuration={200}\n      position={fen}\n      width={400}\n      orientation={getSideToPlayFromFen(tactic.fen) === \"b\" ? \"white\" : \"black\"}\n      onDrop={(move) =>\n        handleMove({\n          from: move.sourceSquare,\n          to: move.targetSquare,\n          promotion: \"q\",\n        })\n      }\n    />\n  );\n};\n\nexport default TacticBoard;\n","import \"./App.css\";\nimport { useEffect, useState } from \"react\";\nimport Tactic from \"./types/Tactic\";\nimport TacticBoard from \"./components/TacticBoard\";\nimport axios from \"axios\";\nimport { errorSound, getSideToPlayFromFen, moveSound } from \"./utils\";\n\nfunction App() {\n  const [tactics, setTactics] = useState<Tactic[]>([]);\n  const [hint, setHint] = useState<\n    \"sideToPlay\" | \"incorrect\" | \"correct\" | \"solved\"\n  >(\"sideToPlay\");\n\n  const loadTactic = async () => {\n    try {\n      const newTactic = await fetchTactic();\n      setTactics((it) => it.concat(newTactic));\n      setHint(\"sideToPlay\");\n    } catch (error) {\n      console.log(\"Error loading tactic\", { error });\n    }\n  };\n\n  useEffect(() => {\n    loadTactic();\n    loadTactic();\n  }, []);\n\n  if (tactics.length === 0) {\n    return <div className=\"overlay-loading\">Loading...</div>;\n  }\n\n  const tactic = tactics[0];\n\n  const sideToPlay = getSideToPlayFromFen(tactic.fen);\n\n  return (\n    <div className=\"flex-center\">\n      <h1>Tactics Trainer</h1>\n      <TacticBoard\n        key={tactic.id}\n        tactic={tactic}\n        onCorrect={() => {\n          moveSound.play();\n          setHint(\"correct\");\n          setTimeout(() => setHint(\"sideToPlay\"), 1000);\n        }}\n        onIncorrect={() => {\n          errorSound.play();\n          setHint(\"incorrect\");\n          setTimeout(() => setHint(\"sideToPlay\"), 1000);\n        }}\n        onSolve={() => {\n          moveSound.play();\n          setHint(\"solved\");\n          setTactics((it) => it.slice(1));\n          loadTactic();\n        }}\n        onAutoPlay={() => {\n          moveSound.play();\n        }}\n      />\n      {hint === \"sideToPlay\" && (\n        <div className=\"tactic-hint\">\n          {sideToPlay === \"b\" ? \"White\" : \"Black\"} to move\n        </div>\n      )}\n\n      {hint === \"correct\" && (\n        <div className=\"tactic-hint tactic-hint-success\">Correct!</div>\n      )}\n\n      {hint === \"incorrect\" && (\n        <div className=\"tactic-hint tactic-hint-error\">Incorrect!</div>\n      )}\n\n      {hint === \"solved\" && (\n        <div className=\"tactic-hint tactic-hint-success\">Solved!</div>\n      )}\n    </div>\n  );\n}\n\nasync function fetchTactic() {\n  const res = await axios.post(\n    `${process.env.REACT_APP_CHESSBLUNDERS_API}/blunder/get`,\n    {\n      type: \"explore\",\n    }\n  );\n\n  const data = res.data.data;\n\n  return {\n    id: data.id,\n    fen: data.fenBefore,\n    blunderMove: data.blunderMove,\n    solution: data.forcedLine,\n  };\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}